import { supabase } from '../lib/supabase';

export const checkDatabase = async () => {
  console.log('üîç Verificando estado de la base de datos...');
  
  const results = {
    products: { count: 0, error: null as any },
    categories: { count: 0, error: null as any },
    product_variants: { count: 0, error: null as any },
    product_images: { count: 0, error: null as any },
    user_roles: { count: 0, error: null as any }
  };

  // Verificar productos
  try {
    const { count, error } = await supabase
      .from('products')
      .select('*', { count: 'exact', head: true });
    results.products = { count: count || 0, error };
    console.log('üì¶ Productos:', count || 0, error ? `Error: ${error.message}` : 'OK');
  } catch (err) {
    results.products.error = err;
    console.error('‚ùå Error verificando productos:', err);
  }

  // Verificar categor√≠as
  try {
    const { count, error } = await supabase
      .from('categories')
      .select('*', { count: 'exact', head: true });
    results.categories = { count: count || 0, error };
    console.log('üìÇ Categor√≠as:', count || 0, error ? `Error: ${error.message}` : 'OK');
  } catch (err) {
    results.categories.error = err;
    console.error('‚ùå Error verificando categor√≠as:', err);
  }

  // Verificar variantes
  try {
    const { count, error } = await supabase
      .from('product_variants')
      .select('*', { count: 'exact', head: true });
    results.product_variants = { count: count || 0, error };
    console.log('üîß Variantes:', count || 0, error ? `Error: ${error.message}` : 'OK');
  } catch (err) {
    results.product_variants.error = err;
    console.error('‚ùå Error verificando variantes:', err);
  }

  // Verificar im√°genes
  try {
    const { count, error } = await supabase
      .from('product_images')
      .select('*', { count: 'exact', head: true });
    results.product_images = { count: count || 0, error };
    console.log('üñºÔ∏è Im√°genes:', count || 0, error ? `Error: ${error.message}` : 'OK');
  } catch (err) {
    results.product_images.error = err;
    console.error('‚ùå Error verificando im√°genes:', err);
  }

  // Verificar roles
  try {
    const { count, error } = await supabase
      .from('user_roles')
      .select('*', { count: 'exact', head: true });
    results.user_roles = { count: count || 0, error };
    console.log('üë• Roles:', count || 0, error ? `Error: ${error.message}` : 'OK');
  } catch (err) {
    results.user_roles.error = err;
    console.error('‚ùå Error verificando roles:', err);
  }

  // Resumen
  console.log('\nüìä RESUMEN DE LA BASE DE DATOS:');
  console.log('================================');
  Object.entries(results).forEach(([table, result]) => {
    const status = result.error ? '‚ùå' : '‚úÖ';
    const count = result.count;
    const error = result.error ? ` (Error: ${result.error.message})` : '';
    console.log(`${status} ${table}: ${count} registros${error}`);
  });

  // Verificar si hay datos suficientes
  const hasProducts = results.products.count > 0;
  const hasCategories = results.categories.count > 0;
  
  console.log('\nüéØ DIAGN√ìSTICO:');
  console.log('================');
  
  if (!hasProducts) {
    console.log('‚ö†Ô∏è PROBLEMA: No hay productos en la base de datos');
    console.log('üí° SOLUCI√ìN: Agrega algunos productos a la tabla "products"');
  }
  
  if (!hasCategories) {
    console.log('‚ö†Ô∏è PROBLEMA: No hay categor√≠as en la base de datos');
    console.log('üí° SOLUCI√ìN: Agrega algunas categor√≠as a la tabla "categories"');
  }
  
  if (hasProducts && hasCategories) {
    console.log('‚úÖ La base de datos parece estar configurada correctamente');
  }

  return results;
};

// Funci√≥n para insertar datos de ejemplo
export const insertSampleData = async () => {
  console.log('üîÑ Insertando datos de ejemplo...');
  
  try {
    // Insertar categor√≠as
    const { error: categoriesError } = await supabase
      .from('categories')
      .insert([
        { name: 'Anillos', description: 'Anillos de lujo' },
        { name: 'Collares', description: 'Collares exclusivos' },
        { name: 'Pulseras', description: 'Pulseras elegantes' },
        { name: 'Pendientes', description: 'Pendientes √∫nicos' }
      ]);
    
    if (categoriesError) {
      console.log('‚ö†Ô∏è Error insertando categor√≠as (puede que ya existan):', categoriesError.message);
    } else {
      console.log('‚úÖ Categor√≠as insertadas');
    }

    // Insertar productos de ejemplo
    const { data: categoryData } = await supabase
      .from('categories')
      .select('id')
      .limit(1);
    
    if (categoryData && categoryData.length > 0) {
      const { error: productsError } = await supabase
        .from('products')
        .insert([
          {
            name: 'Anillo de Compromiso Diamante',
            price: 15000,
            original_price: 18000,
            image: '/images/anillos/anillo-compromiso_diamante_solitario.jpg',
            description: 'Anillo de compromiso con diamante solitario de 1 quilate',
            material: 'Oro blanco 18k',
            in_stock: true,
            is_new: true,
            is_featured: true,
            category_id: categoryData[0].id,
            stock: 5
          },
          {
            name: 'Collar Riviere Oro Blanco',
            price: 8500,
            original_price: 10000,
            image: '/images/collares/collar_riviere_oro_blanco_con_diamantes.png',
            description: 'Collar riviere con diamantes en oro blanco',
            material: 'Oro blanco 18k',
            in_stock: true,
            is_new: false,
            is_featured: true,
            category_id: categoryData[0].id,
            stock: 3
          }
        ]);
      
      if (productsError) {
        console.log('‚ö†Ô∏è Error insertando productos:', productsError.message);
      } else {
        console.log('‚úÖ Productos de ejemplo insertados');
      }
    }
    
  } catch (err) {
    console.error('‚ùå Error insertando datos de ejemplo:', err);
  }
};


